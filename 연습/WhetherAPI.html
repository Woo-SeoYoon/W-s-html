<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>
<body>
    <script>
        async function getPosition(city,limit,key,pUrl){
            const result = await $.ajax({
                url: pUrl,
                data:{q:city, limit:limit, appid:key},
                method:'get',
                processData:true

            });
            return{위도:result[0].lat, 경도:result[0].lon};

             }
            async function getWeather(position, key, wUrl){
                const {위도,경도} = position;
            return await $.ajax({
                url:wUrl,
                method:'get',
                data:{lat:위도, lon:경도, appid:key}
            })        
            }

            async function getAir({위도,경도},key,aUrl){
                return await $.ajax({
                url:aUrl, method:'get', data: {lat:위도, lon:경도, appid:key}
            })
            }
            



        $(document).ready(async function(){
            const key = '4e96bbe63437be4054581d930fdd2021';
            const city = 'Incheon';
            const pUrl= 'http://api.openweathermap.org/geo/1.0/direct';
            const aUrl='http://api.openweathermap.org/data/2.5/air_pollution';
            const wUrl='https://api.openweathermap.org/data/2.5/onecall';
            const limit =1;
            const position = await getPosition(city,limit,key,pUrl);
            const weather = await getWeather(position,key,wUrl);
            const air = await getAir(position,key,aUrl);

            console.log(position);
            console.log(weather);
            console.log(air);
            //시간을 출력하자 (+포맷이 꼭붙어다님)
            //daily: 주간예보를 뜻함  daily[0]~[7]. daily[0]은 오늘을 뜻함.
            //시간: 출력이 대단히대단히 복잡함
              //-1970년 1월 1일 이후 흘러가 밀리초 ; UTC

            const date = new Date(weather.daily[1].sunrise*1000);
            console.log(date);
            console.log(`${date.getMonth()}월 ${date.getDate()}일`);
            console.log(`${date.getHours()}시 ${date.getMinutes()}분`);
            //aUrl,wUrl에 대한 Ajax 요청을 보내자


        })
    </script>
</body>
</html>